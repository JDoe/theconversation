{% extends "../base.html" %}

{% block title %}{{ post['title'] }}{% end %}

{% block javascript %}
<script type="text/javascript">
    if(!window.Kolich){
        Kolich = {};
    }

    Kolich.Selector = {};
    Kolich.Selector.getSelected = function(){
        var t = '';
        if(window.getSelection){
            t = window.getSelection();
        }else if(document.getSelection){
            t = document.getSelection();
        }else if(document.selection){
            t = document.selection.createRange().text;
        }
        return t;
    }

    Kolich.Selector.mouseup = function(){
        var st = Kolich.Selector.getSelected();
        if(st!=''){
            alert("You selected:\n"+st);
            // Call the backend to create the selection

        }
    }

    $(document).ready(function(){
        $(".post_content").bind("mouseup", Kolich.Selector.mouseup);
    });
</script>
{% end %}

{% block content %}
    <div class="post post_detail">
        <h2>
            <a href="/posts/{{ minifier.int_to_base62(post['_id']) }}">{{ post['title'] }}</a>
        </h2>

        <p class="post_info">
            by: 
            <a href="http://twitter.com/{{ post['user']['username'] }}">
                @{{ post['user']['username'] }}
            </a>
            on
            {{ post['date_created'].strftime("%B %d, %Y") }}
        </p>

        <div class="post_content">{% raw post['body_html'] %}</p>

        <br/>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
             (function() {
                var disqus_shortname = 'usv'; // required: replace example with your forum shortname
                var disqus_developer = 1; // developer mode is on
                var disqus_identifier = "{{ post['_id'] }}";
                var disqus_url = "/posts/{{ minifier.int_to_base62(post['_id']) }}";

                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
{% end %}
