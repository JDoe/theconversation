{% extends "../base.html" %}

{% block title %}Submit{% end %}

{% block css %}
<link rel="stylesheet" type="text/css" href="/static/css/new_new.css" />
<style type="text/css">
    .container-fluid {
        margin-top: 50px !important;
    }
    #navigation_bar {
        position: static !important;
    }
    @media (max-width: 874px) {
        .container-fluid {
            margin-top: 0px !important;
        }
    }
</style>
{% end %}

{% block javascript %}
<script type="text/javascript" src="/static/js/tiny_mce/jquery.tinymce.js"></script>

<script type="text/javascript">
$(function() {
  // Transform checkboxes into labeled buttons
  $('.link_form input[type=checkbox]').each(function(i, o) {
    var checkbox = $(this);
    // Extract label
    var label = $(".link_form label[for='"+checkbox.attr('id')+"']");
    var label_unselected = label.html();
    var label_selected = label.attr('data-selected');
    // Hide
    label.remove();
    checkbox.hide();

    var button = '<button type="button" data-toggle="button" class="btn btn-large btn-block check_button" ' +
                            'id="' + checkbox.attr('id') + '_button">';
    button += label_unselected;
    button += '</button>';
    button = $(button);

    if(checkbox.attr('checked')) {
      button.addClass('active');
      button.html(label_selected);
    }

    button.on('click', function(e) {
      if(checkbox.attr('checked')) {
        // Uncheck
        checkbox.attr('checked', false).change();
        button.html(label_unselected);
      } else {
        // Check
        checkbox.attr('checked', true).change();
        button.html(label_selected);
      }
    });

    $(this).after(button);
  });

    $('').on('click', function(e) {
      if(checkbox.attr('checked')) {
        // Uncheck
        checkbox.attr('checked', false).change();
        button.html(label_unselected);
      } else {
        // Check
        checkbox.attr('checked', true).change();
        button.html(label_selected);
      }
    });
    $('.post_submit_bar .btn').on("click", function(e) {
       $('.post_form').submit();
    });
});
</script>
{% end %}

{% block content %}
<div class="link_form">
  <form action="/links{{ ('/' + str(model.id)) if not model._created else '' }}" method="post" class="post_form">
      <div class="form_contents">
          {% module xsrf_form_html() %}
          {% set hackpad_icon = lambda x: '<div class="input-prepend hackpad_input"><span class="add-on">'\
                                              '<img src="/static/images/hackpad_icon.png" alt="hackpad"></span>%s</div>' % x
                                          %}

          {% set link_icon = lambda x: '<div class="input-prepend"><span class="add-on">'\
                                              '<i class="icon-bookmark"></i></span>%s</div>' % x
          %}
          {% set wrap_text = lambda x: '<div class="text_wrapper">%s</div>' % x %}
          {% set form_fields = [
          {
            'name': 'title',
            'placeholder': 'Title...',
            'wrapper': wrap_text,
          },
          {
            'name': 'url',
            'placeholder': 'URL',
            'wrapper': link_icon,
          }]
          %}

          {% if not model._created %}
              {% set form_fields = form_fields + [{
                'name': 'deleted',
                'label': '<i class="icon-remove"></i>&nbsp;Delete this link?',
                'label_selected': '<i class="icon-remove"></i>&nbsp;Un-delete this link',
              }]%}
          {% end %}

          {% for name, html, field_errors in model.form_fields(errors, form_fields=form_fields) %}
                  {% if field_errors %}
                      <i>&darr;&nbsp;{{ field_errors.message }}</i>
                      <br/>
                  {% end %}
                  {% raw html %}
          {% end %}
          <div class="text_wrapper">
            <input type="text" name="tags" placeholder="Categories (optional, separate by commas)" />
          </div>
          {% if model._created %}
              {% if recaptcha_error %}
                <i>&darr;&nbsp;Invalid CAPTCHA code. Please try again.</i>
              {% end %}
              {% raw recaptcha_render() %}
          {% end %}
          <div class="post_submit_bar">
            <div class="btn">
              <div class="icon-plus-sign"></div>
              {% if model._created %}
                Submit
              {% else %}
                Save
              {% end %}
            </div>
          </div>
      </div>
  </form>
</div>
{% end %}
