{% extends '../base.html' %}
{% block body_class %}conversation{% end %}

{% block title %}
    {{ post.title }} | 
{% end %}

{% block content %}
<div id="main" role="main">
  {% if subscribe and user_info and post.user.id_str == user_info.user.id_str %}
  <script type="text/javascript">
      $(function() {
              $("#subscribe-modal").modal('show');
      });
  </script>
  {% end %}

  <div class="modal" id="subscribe-modal">
    <form id="subscribe-form" action="/auth/email/" method="POST">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Subscribe to this post</h4>
        </div>
        <div class="modal-body">
            {% module xsrf_form_html() %}
            <input type="hidden" name="next" value="/posts/{{ post.slug }}" />
            <input type="hidden" name="subscribe_to" value="{{ post.id }}" />
            <p>Your post has been submitted! If you would like to receive
            email updates when people comment on this and all future posts
            you submit, please provide your email address.</p>
            <br/>
            <label for="email">Email</label>
            <br/>
            <input id="email" name="email" type="text"
                                placeholder="john@gmail.com" value=""
                                style="width: 100%">
            <p>This email address will not be shared or displayed.</p>
        </div>
        <div class="modal-footer">
            <button type="submit" class="btn">Submit</button>
        </div>
      </div>
    </div>
    </form>
  </div>


    <div class="row article-post single community">
        <!--<div class="col-sm-2 post-links">
            
        </div>--><!-- /.col3 -->
        <div class="col-sm-8 col-sm-offset-2">
            <article class="usv-post">
                <h1>
                    {% if post.url %}
                    <a href="{{ post.url }}" target="_blank">{{ post.title }}</a>
                    {% else %}
                        {{ post.title }}
                    {% end %}
                </h1>
                
                <div class="post-meta clearfix row">
                    <div class="col-sm-2 upvote">
                        {% module ajax_upvote_link(post=post) %}
                    </div>
                    
                    <div class="col-sm-2 tweet">
                          <a href="https://twitter.com/share" class="twitter-share-button" data-via="">Tweet</a>
                            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>  
                    </div> 
                    
                    <div class="col-sm-4 tags">
                        {% if post.tags %}
                            <span class="post-tags">
                            {% for count, tag in enumerate(post.tags) %}
                                <a href="/tagged/{{ url_escape(tag) }}">#{{ tag }}</a>{% if count < len(post.tags) -1 %}, {% end %}
                            {% end %}
                            </span>
                        {% end %}
                    </div>
                
                    <div class="col-sm-4 source">
                           {% if post.url %}
                           <a class="post-source" href="{{ post.url }}">{{ urlparse(post.url).netloc }} &rarr;</a>
                           {% end %}
                       </div>   
                    
                
                </div><!-- .post-meta -->
            
                  
            <div class="profile-photo">
                <a href="http://www.twitter.com/{{ post.user.username }}" title="@{{ post.user.username }}" target="_blank">
                  <img src="{{ twitter_avatar_size(post.user.profile_image_url_https, 'original') }}" alt="thumbnail">
                </a>
                <!--<span class="author-name">{{ post.user.fullname }}</span>
                {% if is_staff(post.user.username) %}
                <span class="staff">USV Team</span>
                {% end %}
            -->
                
            </div>
                        
            <div class="post-body">
                <span class="post-author"><a href="http://www.twitter.com/{{ post.user.username }}" title="@{{ post.user.username }}">{{ post.user.username }}</a>
                <span class="text-muted">&nbsp;<span style="color: #ddd">&bull;</span>&nbsp; {{ pretty_date(post.date_created) }}</span>
            </span>
                
              {#
                <a class="shared-link" href="http://apple.com/example-of-very-long-url-slug" target="_blank" title="Source: http://apple.com/example-of-very-long-url-slug">
                    <span>apple.com/example-of-very-long-url-slug &rarr;</span>
                </a>
              #}
                {% raw post.body_html %}
                
                {% if post.url and (urlparse(post.url).netloc == "twitter.com" or urlparse(post.url).netloc == "www.twitter.com") %}
                <br /><br />
                <blockquote class="twitter-tweet">
                    <a href="{{ post.url }}"></a>
                </blockquote>
                <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
                {% end %}
                
                {% if post.url and (urlparse(post.url).netloc == "youtube.com" or urlparse(post.url).netloc == "www.youtube.com") %}
                {% set vid_id = post.url.split("=")[1] %}
                <br /><br />
                <iframe width="560" height="315" src="http://youtube.com/embed/{{ vid_id }}" frameborder="0" allowfullscreen></iframe>
                {% end %}
                
                {% if post.url and (urlparse(post.url).netloc == "vimeo.com" or urlparse(post.url).netloc == "www.vimeo.com") %}
                {% set vid_id = urlparse(post.url).path %}
                <iframe src="//player.vimeo.com/video{{ vid_id }}" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
                {% end %}

            
                {% if post.has_hackpad and post.hackpad_url %}
                  <p><a class="post-body-hackpad-link" target="_blank" href="{{ post.hackpad_url }}">Hackpad &rarr;</a></p>
                {% end %}
            </div><!--end of post-body-->
            
            <div class="share-widget for-mobile">
                <!--<span class="heading">Share Post</span>-->
                <div class="share-twitter" data-url="{{ 'http://%s/posts/%s' % (settings.base_url, post.slug) }}" data-text="{{ post.title }}"></div>
                <div class="share-facebook" data-url="{{ 'http://%s/posts/%s' % (settings.base_url, post.slug) }}" data-text="{{ post.title }}"></div>
                <div class="share-googleplus" data-url="{{ 'http://%s/posts/%s' % (settings.base_url, post.slug) }}" data-text="{{ post.title }}"></div>
            </div>
            
            
            
            <div class="comment-box">
                <div id="disqus_thread"></div>
            
                <script type="text/javascript">
                    var disqus_config = function() {
                        {% raw disqus_sso %}
                        this.page.api_key = '{{ settings.disqus_public_key }}';
            
                        this.sso = {
                              name: "USV",
                              button: "{{ 'http://%s/%s' % (settings.base_url, 'static/img/disqus-sso-login-button.png') }}",
                              icon: "{{ 'http://%s/%s' % (settings.base_url, 'static/favicon.png') }}",
                              url: "{% raw 'http://%s/%s%s' % (settings.base_url, 'auth/twitter/?email_required=1&close_popup=1'\
                                                                                            '&next=', url_escape(handler.request.path)) %}",
                              logout: "{% raw 'http://%s/%s%s' % (settings.base_url, 'auth/logout/?next=', url_escape(handler.request.path)) %}",
                              width: "600",
                              height: "600"
                        };
                };
                </script>
            
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = "{{ settings.disqus_apikey }}"; // required: replace example with your forum shortname
                    var disqus_identifier = "{{ post.id }}";
                    var disqus_title = "{{ post.title }}";
            
                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div><!--end of comment-box-->
            
        </article>
            
        </div><!-- /.col6 -->
        
        <div class="col-sm-2" style="display:none">
            <div class="profile-links">
                <p class="hidden-xs">{% module ajax_upvote_link(post=post) %}
                    
                    
                    </p>
                
               <!-- <a href="/posts/{{ post.slug }}#disqus_thread" class="comments-button"
                                        data-disqus-identifier="{{ post.id }}">0 comments</a>-->
            
            <p><a href="https://twitter.com/share" class="twitter-share-button" data-via="">Tweet</a></p>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
            
            
            {% if post.user.id_str == user_id_str or is_staff(username) %}
            <hr />
                <p><a href="/posts/{{ post.slug }}/edit" class="btn">Edit</a></p>
            {% end %}
            
            {% if is_staff(username) %}
            <hr />
            {% if author.user.is_blacklisted %}
            <p><a class="btn btn-success" href="/users/{{ post.user.username }}/unban">Unban this user</a>
            {% else %}
            <p><a class="btn btn-danger" href="/users/{{ post.user.username }}/ban">Ban this user</a>
            {% end %}
            {% end %}
            <!--<br />
            <script src="//platform.linkedin.com/in.js" type="text/javascript">
             lang: en_US
            </script>
            <script type="IN/Share" data-counter="right"></script>
        -->
            
                <!--
                <div class="share-widget">
                    <div class="share-twitter" data-url="{{ 'http://%s/posts/%s' % (settings.base_url, post.slug) }}" data-text="{{ post.title }}"></div>
                    <div class="share-facebook" data-url="{{ 'http://%s/posts/%s' % (settings.base_url, post.slug) }}" data-text="{{ post.title }}"></div>
                    <div class="share-googleplus" data-url="{{ 'http://%s/posts/%s' % (settings.base_url, post.slug) }}" data-text="{{ post.title }}"></div>
                </div>
            -->
            </div>
        </div><!-- /col3 -->
        
        
    </div><!-- /.row -->

</div><!--end of main-->
{% end %}
