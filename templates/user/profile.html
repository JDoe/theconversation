{% extends '../base.html' %}

{% block body_class %}conversation{% end %}

{% block content %}
  <div id="main" role="main">
    <section class="hot-newest-feed">

      <ul class="tabs">
        <li class="{{ 'is-active' if section == 'shares' else '' }}"><a class="sort btn" href="?section=shares">{{screen_name}} Shares</a></li>
        <li class="{{ 'is-active' if section == 'mentions' else '' }}"><a class="sort btn" href="?section=mentions">Mentions</a></li>
      </ul>

      <ul class="swipe-wrap feed">
        {% for post in posts %}
          <div class="featured-post">
            <div class="content">
              <a class="title" href="/posts/{{ post['slug'] }}">{{ post['title'] }}</a>
              {% if post['url'] %}
                <a href="{{ post['url'] }}" class="source" target="_blank">{{ urlparse(post['url']).netloc }}</a>
              {% else %}
                <a href="/posts/{{ post['slug'] }}" class="source">usv.com</a>
              {% end %}
              <div class="excerpt">{{ post['body_truncated'] }}</div>
              <div class="meta">
                <div class="avatar">
                  <a href="http://www.twitter.com/{{ post['user']['username'] }}" target="_blank">
                    <img title="{{ post['user']['username'] }}" src="{{ post['user']['profile_image_url_https'] }}" alt="thumbnail">
                  </a>
                </div>
                @{{ post['user']['username'] }}
                <span class="time">{{ template_helpers.pretty_date(post['date_created']) }}</span>
                <a href="/posts/{{ post['slug'] }}/upvote" class="votes-count ajax_upvote_link upvote-button">
                  <span class="glyphicon glyphicon-chevron-up"></span>
                  <span class="value">{{ post['votes'] }} vote{{ 's' if post['votes'] != 1 else '' }}</span>
                </a>
                <a class="dsq-comment-count" href="/posts/{{ post['slug'] }}" data-disqus-url="/posts/{{post['slug']}}" data-disqus-identifier="{{ str(post['_id']) }}" target="_blank">{{ post['comment_count'] }} comment{{ 's' if post['comment_count'] != 1 else '' }}</a>
              </div>
            </div>
          </div>
        {% end %}
      </ul>

      <div id="pagination-next-prev"></div>

    </section>
  </div>
{% end %}

{% block javascript %}
  <script type="text/javascript">
    $(document).ready(function() {
      {% if current_user %}
        $('#submit-modal .submit').show();
        {% if current_user in settings.get('staff') %}
          $('#submit-modal .login').hide();
          $('#submit-modal .submit-staff').show();
          $('a.mute').click(function(e) {
            e.preventDefault();
            if (confirm("are you sure?")) {
              window.location = this.href;
            }
          })
        {% else %}
          $('#submit-modal .login').hide();
        {% end %}
      {% end %}
    }); 
  </script>
{% end %}
