{% extends "../base.html" %}

{% block title %}Create a post{% end %}

{% block content %}
    <h1>Create a post</h1>
    <form action="/posts/{{ post_id }}" method="post">
        {% module xsrf_form_html() %}

        {% for name, label, html, field_errors in model.form_fields(errors) %}
                <label for="{{ name }}">
                    {{ label }}
                </label>
                {% if field_errors %}
                    <i>{{ field_errors.message }}</i>
                    <br/>
                {% end %}
                {% raw html %}
                <br/>
                <br/>
        {% end %}

        <label>Tags</label>
        <p class="label_description">(separate with a space)</p>
        <input type="text" name="tags" />

        <label>Questions</label>
        <div id="questions">
            <div id="questions_template">
                <input type="text" value="" name="text" />
                <a href="javascript:void(0);" class="plus">+</a>
                <a href="javascript:void(0);" class="minus">-</a>
            </div>

        </div>

        <script src="/static/js/jquery-dynamic-form.js"></script>
        <script type="text/javascript">
            $(function() {
                var template = $('#questions_template').clone();
                $('#questions_template').remove();

                var handle_add = function (e) {
                    var newq = template.clone();
                    $('#questions').append(newq);
                    $.each(newq.children('input'), function(i, o) {
                        var n = 'question' + '[' + newq.index() + ']' + '[' + $(this).attr('name') + ']';
                        $(this).attr('name', n);
                    });
                    newq.children('.plus').on("click", handle_add);
                    newq.children('.minus').on("click", handle_remove);
                    if(e) {
                        e.stopPropagation();
                    }
                };
                var handle_remove = function (e) {
                    $(this).parent().remove();
                    e.stopPropagation();
                };
                handle_add();
                $('#questions_template .minus').first().remove();
            });
        </script>

        <br/>
        <input type="submit" value="Submit" />
    </form>
{% end %}
